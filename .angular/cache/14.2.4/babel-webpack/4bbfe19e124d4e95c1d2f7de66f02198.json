{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.FindOperation = void 0;\n\nconst operation_1 = require(\"./operation\");\n\nconst utils_1 = require(\"../utils\");\n\nconst error_1 = require(\"../error\");\n\nconst command_1 = require(\"./command\");\n\nconst sort_1 = require(\"../sort\");\n\nconst shared_1 = require(\"../cmap/wire_protocol/shared\");\n\nconst read_concern_1 = require(\"../read_concern\");\n\nconst SUPPORTS_WRITE_CONCERN_AND_COLLATION = 5;\n/** @internal */\n\nclass FindOperation extends command_1.CommandOperation {\n  constructor(collection, ns, filter = {}, options = {}) {\n    super(collection, options);\n    this.options = options;\n    this.ns = ns;\n\n    if (typeof filter !== 'object' || Array.isArray(filter)) {\n      throw new error_1.MongoInvalidArgumentError('Query filter must be a plain object or ObjectId');\n    } // If the filter is a buffer, validate that is a valid BSON document\n\n\n    if (Buffer.isBuffer(filter)) {\n      const objectSize = filter[0] | filter[1] << 8 | filter[2] << 16 | filter[3] << 24;\n\n      if (objectSize !== filter.length) {\n        throw new error_1.MongoInvalidArgumentError(`Query filter raw message size does not match message header size [${filter.length}] != [${objectSize}]`);\n      }\n    } // special case passing in an ObjectId as a filter\n\n\n    this.filter = filter != null && filter._bsontype === 'ObjectID' ? {\n      _id: filter\n    } : filter;\n  }\n\n  execute(server, session, callback) {\n    this.server = server;\n    const serverWireVersion = utils_1.maxWireVersion(server);\n    const options = this.options;\n\n    if (options.allowDiskUse != null && serverWireVersion < 4) {\n      callback(new error_1.MongoCompatibilityError('Option \"allowDiskUse\" is not supported on MongoDB < 3.2'));\n      return;\n    }\n\n    if (options.collation && serverWireVersion < SUPPORTS_WRITE_CONCERN_AND_COLLATION) {\n      callback(new error_1.MongoCompatibilityError(`Server ${server.name}, which reports wire version ${serverWireVersion}, does not support collation`));\n      return;\n    }\n\n    if (serverWireVersion < 4) {\n      if (this.readConcern && this.readConcern.level !== 'local') {\n        callback(new error_1.MongoCompatibilityError(`Server find command does not support a readConcern level of ${this.readConcern.level}`));\n        return;\n      }\n\n      const findCommand = makeLegacyFindCommand(this.ns, this.filter, options);\n\n      if (shared_1.isSharded(server) && this.readPreference) {\n        findCommand.$readPreference = this.readPreference.toJSON();\n      }\n\n      server.query(this.ns, findCommand, { ...this.options,\n        ...this.bsonOptions,\n        documentsReturnedIn: 'firstBatch',\n        readPreference: this.readPreference\n      }, callback);\n      return;\n    }\n\n    let findCommand = makeFindCommand(this.ns, this.filter, options);\n\n    if (this.explain) {\n      findCommand = utils_1.decorateWithExplain(findCommand, this.explain);\n    }\n\n    server.command(this.ns, findCommand, { ...this.options,\n      ...this.bsonOptions,\n      documentsReturnedIn: 'firstBatch',\n      session\n    }, callback);\n  }\n\n}\n\nexports.FindOperation = FindOperation;\n\nfunction makeFindCommand(ns, filter, options) {\n  const findCommand = {\n    find: ns.collection,\n    filter\n  };\n\n  if (options.sort) {\n    findCommand.sort = sort_1.formatSort(options.sort);\n  }\n\n  if (options.projection) {\n    let projection = options.projection;\n\n    if (projection && Array.isArray(projection)) {\n      projection = projection.length ? projection.reduce((result, field) => {\n        result[field] = 1;\n        return result;\n      }, {}) : {\n        _id: 1\n      };\n    }\n\n    findCommand.projection = projection;\n  }\n\n  if (options.hint) {\n    findCommand.hint = utils_1.normalizeHintField(options.hint);\n  }\n\n  if (typeof options.skip === 'number') {\n    findCommand.skip = options.skip;\n  }\n\n  if (typeof options.limit === 'number') {\n    if (options.limit < 0) {\n      findCommand.limit = -options.limit;\n      findCommand.singleBatch = true;\n    } else {\n      findCommand.limit = options.limit;\n    }\n  }\n\n  if (typeof options.batchSize === 'number') {\n    if (options.batchSize < 0) {\n      if (options.limit && options.limit !== 0 && Math.abs(options.batchSize) < Math.abs(options.limit)) {\n        findCommand.limit = -options.batchSize;\n      }\n\n      findCommand.singleBatch = true;\n    } else {\n      findCommand.batchSize = options.batchSize;\n    }\n  }\n\n  if (typeof options.singleBatch === 'boolean') {\n    findCommand.singleBatch = options.singleBatch;\n  }\n\n  if (options.comment) {\n    findCommand.comment = options.comment;\n  }\n\n  if (typeof options.maxTimeMS === 'number') {\n    findCommand.maxTimeMS = options.maxTimeMS;\n  }\n\n  const readConcern = read_concern_1.ReadConcern.fromOptions(options);\n\n  if (readConcern) {\n    findCommand.readConcern = readConcern.toJSON();\n  }\n\n  if (options.max) {\n    findCommand.max = options.max;\n  }\n\n  if (options.min) {\n    findCommand.min = options.min;\n  }\n\n  if (typeof options.returnKey === 'boolean') {\n    findCommand.returnKey = options.returnKey;\n  }\n\n  if (typeof options.showRecordId === 'boolean') {\n    findCommand.showRecordId = options.showRecordId;\n  }\n\n  if (typeof options.tailable === 'boolean') {\n    findCommand.tailable = options.tailable;\n  }\n\n  if (typeof options.timeout === 'boolean') {\n    findCommand.noCursorTimeout = !options.timeout;\n  } else if (typeof options.noCursorTimeout === 'boolean') {\n    findCommand.noCursorTimeout = options.noCursorTimeout;\n  }\n\n  if (typeof options.awaitData === 'boolean') {\n    findCommand.awaitData = options.awaitData;\n  }\n\n  if (typeof options.allowPartialResults === 'boolean') {\n    findCommand.allowPartialResults = options.allowPartialResults;\n  }\n\n  if (options.collation) {\n    findCommand.collation = options.collation;\n  }\n\n  if (typeof options.allowDiskUse === 'boolean') {\n    findCommand.allowDiskUse = options.allowDiskUse;\n  }\n\n  if (options.let) {\n    findCommand.let = options.let;\n  }\n\n  return findCommand;\n}\n\nfunction makeLegacyFindCommand(ns, filter, options) {\n  const findCommand = {\n    $query: filter\n  };\n\n  if (options.sort) {\n    findCommand.$orderby = sort_1.formatSort(options.sort);\n  }\n\n  if (options.hint) {\n    findCommand.$hint = utils_1.normalizeHintField(options.hint);\n  }\n\n  if (typeof options.returnKey === 'boolean') {\n    findCommand.$returnKey = options.returnKey;\n  }\n\n  if (options.max) {\n    findCommand.$max = options.max;\n  }\n\n  if (options.min) {\n    findCommand.$min = options.min;\n  }\n\n  if (typeof options.showRecordId === 'boolean') {\n    findCommand.$showDiskLoc = options.showRecordId;\n  }\n\n  if (options.comment) {\n    findCommand.$comment = options.comment;\n  }\n\n  if (typeof options.maxTimeMS === 'number') {\n    findCommand.$maxTimeMS = options.maxTimeMS;\n  }\n\n  if (options.explain != null) {\n    findCommand.$explain = true;\n  }\n\n  return findCommand;\n}\n\noperation_1.defineAspects(FindOperation, [operation_1.Aspect.READ_OPERATION, operation_1.Aspect.RETRYABLE, operation_1.Aspect.EXPLAINABLE, operation_1.Aspect.CURSOR_CREATING]);","map":{"version":3,"names":["Object","defineProperty","exports","value","FindOperation","operation_1","require","utils_1","error_1","command_1","sort_1","shared_1","read_concern_1","SUPPORTS_WRITE_CONCERN_AND_COLLATION","CommandOperation","constructor","collection","ns","filter","options","Array","isArray","MongoInvalidArgumentError","Buffer","isBuffer","objectSize","length","_bsontype","_id","execute","server","session","callback","serverWireVersion","maxWireVersion","allowDiskUse","MongoCompatibilityError","collation","name","readConcern","level","findCommand","makeLegacyFindCommand","isSharded","readPreference","$readPreference","toJSON","query","bsonOptions","documentsReturnedIn","makeFindCommand","explain","decorateWithExplain","command","find","sort","formatSort","projection","reduce","result","field","hint","normalizeHintField","skip","limit","singleBatch","batchSize","Math","abs","comment","maxTimeMS","ReadConcern","fromOptions","max","min","returnKey","showRecordId","tailable","timeout","noCursorTimeout","awaitData","allowPartialResults","let","$query","$orderby","$hint","$returnKey","$max","$min","$showDiskLoc","$comment","$maxTimeMS","$explain","defineAspects","Aspect","READ_OPERATION","RETRYABLE","EXPLAINABLE","CURSOR_CREATING"],"sources":["/Users/yoannesfigueiras/node_modules/mongodb/lib/operations/find.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.FindOperation = void 0;\nconst operation_1 = require(\"./operation\");\nconst utils_1 = require(\"../utils\");\nconst error_1 = require(\"../error\");\nconst command_1 = require(\"./command\");\nconst sort_1 = require(\"../sort\");\nconst shared_1 = require(\"../cmap/wire_protocol/shared\");\nconst read_concern_1 = require(\"../read_concern\");\nconst SUPPORTS_WRITE_CONCERN_AND_COLLATION = 5;\n/** @internal */\nclass FindOperation extends command_1.CommandOperation {\n    constructor(collection, ns, filter = {}, options = {}) {\n        super(collection, options);\n        this.options = options;\n        this.ns = ns;\n        if (typeof filter !== 'object' || Array.isArray(filter)) {\n            throw new error_1.MongoInvalidArgumentError('Query filter must be a plain object or ObjectId');\n        }\n        // If the filter is a buffer, validate that is a valid BSON document\n        if (Buffer.isBuffer(filter)) {\n            const objectSize = filter[0] | (filter[1] << 8) | (filter[2] << 16) | (filter[3] << 24);\n            if (objectSize !== filter.length) {\n                throw new error_1.MongoInvalidArgumentError(`Query filter raw message size does not match message header size [${filter.length}] != [${objectSize}]`);\n            }\n        }\n        // special case passing in an ObjectId as a filter\n        this.filter = filter != null && filter._bsontype === 'ObjectID' ? { _id: filter } : filter;\n    }\n    execute(server, session, callback) {\n        this.server = server;\n        const serverWireVersion = utils_1.maxWireVersion(server);\n        const options = this.options;\n        if (options.allowDiskUse != null && serverWireVersion < 4) {\n            callback(new error_1.MongoCompatibilityError('Option \"allowDiskUse\" is not supported on MongoDB < 3.2'));\n            return;\n        }\n        if (options.collation && serverWireVersion < SUPPORTS_WRITE_CONCERN_AND_COLLATION) {\n            callback(new error_1.MongoCompatibilityError(`Server ${server.name}, which reports wire version ${serverWireVersion}, does not support collation`));\n            return;\n        }\n        if (serverWireVersion < 4) {\n            if (this.readConcern && this.readConcern.level !== 'local') {\n                callback(new error_1.MongoCompatibilityError(`Server find command does not support a readConcern level of ${this.readConcern.level}`));\n                return;\n            }\n            const findCommand = makeLegacyFindCommand(this.ns, this.filter, options);\n            if (shared_1.isSharded(server) && this.readPreference) {\n                findCommand.$readPreference = this.readPreference.toJSON();\n            }\n            server.query(this.ns, findCommand, {\n                ...this.options,\n                ...this.bsonOptions,\n                documentsReturnedIn: 'firstBatch',\n                readPreference: this.readPreference\n            }, callback);\n            return;\n        }\n        let findCommand = makeFindCommand(this.ns, this.filter, options);\n        if (this.explain) {\n            findCommand = utils_1.decorateWithExplain(findCommand, this.explain);\n        }\n        server.command(this.ns, findCommand, {\n            ...this.options,\n            ...this.bsonOptions,\n            documentsReturnedIn: 'firstBatch',\n            session\n        }, callback);\n    }\n}\nexports.FindOperation = FindOperation;\nfunction makeFindCommand(ns, filter, options) {\n    const findCommand = {\n        find: ns.collection,\n        filter\n    };\n    if (options.sort) {\n        findCommand.sort = sort_1.formatSort(options.sort);\n    }\n    if (options.projection) {\n        let projection = options.projection;\n        if (projection && Array.isArray(projection)) {\n            projection = projection.length\n                ? projection.reduce((result, field) => {\n                    result[field] = 1;\n                    return result;\n                }, {})\n                : { _id: 1 };\n        }\n        findCommand.projection = projection;\n    }\n    if (options.hint) {\n        findCommand.hint = utils_1.normalizeHintField(options.hint);\n    }\n    if (typeof options.skip === 'number') {\n        findCommand.skip = options.skip;\n    }\n    if (typeof options.limit === 'number') {\n        if (options.limit < 0) {\n            findCommand.limit = -options.limit;\n            findCommand.singleBatch = true;\n        }\n        else {\n            findCommand.limit = options.limit;\n        }\n    }\n    if (typeof options.batchSize === 'number') {\n        if (options.batchSize < 0) {\n            if (options.limit &&\n                options.limit !== 0 &&\n                Math.abs(options.batchSize) < Math.abs(options.limit)) {\n                findCommand.limit = -options.batchSize;\n            }\n            findCommand.singleBatch = true;\n        }\n        else {\n            findCommand.batchSize = options.batchSize;\n        }\n    }\n    if (typeof options.singleBatch === 'boolean') {\n        findCommand.singleBatch = options.singleBatch;\n    }\n    if (options.comment) {\n        findCommand.comment = options.comment;\n    }\n    if (typeof options.maxTimeMS === 'number') {\n        findCommand.maxTimeMS = options.maxTimeMS;\n    }\n    const readConcern = read_concern_1.ReadConcern.fromOptions(options);\n    if (readConcern) {\n        findCommand.readConcern = readConcern.toJSON();\n    }\n    if (options.max) {\n        findCommand.max = options.max;\n    }\n    if (options.min) {\n        findCommand.min = options.min;\n    }\n    if (typeof options.returnKey === 'boolean') {\n        findCommand.returnKey = options.returnKey;\n    }\n    if (typeof options.showRecordId === 'boolean') {\n        findCommand.showRecordId = options.showRecordId;\n    }\n    if (typeof options.tailable === 'boolean') {\n        findCommand.tailable = options.tailable;\n    }\n    if (typeof options.timeout === 'boolean') {\n        findCommand.noCursorTimeout = !options.timeout;\n    }\n    else if (typeof options.noCursorTimeout === 'boolean') {\n        findCommand.noCursorTimeout = options.noCursorTimeout;\n    }\n    if (typeof options.awaitData === 'boolean') {\n        findCommand.awaitData = options.awaitData;\n    }\n    if (typeof options.allowPartialResults === 'boolean') {\n        findCommand.allowPartialResults = options.allowPartialResults;\n    }\n    if (options.collation) {\n        findCommand.collation = options.collation;\n    }\n    if (typeof options.allowDiskUse === 'boolean') {\n        findCommand.allowDiskUse = options.allowDiskUse;\n    }\n    if (options.let) {\n        findCommand.let = options.let;\n    }\n    return findCommand;\n}\nfunction makeLegacyFindCommand(ns, filter, options) {\n    const findCommand = {\n        $query: filter\n    };\n    if (options.sort) {\n        findCommand.$orderby = sort_1.formatSort(options.sort);\n    }\n    if (options.hint) {\n        findCommand.$hint = utils_1.normalizeHintField(options.hint);\n    }\n    if (typeof options.returnKey === 'boolean') {\n        findCommand.$returnKey = options.returnKey;\n    }\n    if (options.max) {\n        findCommand.$max = options.max;\n    }\n    if (options.min) {\n        findCommand.$min = options.min;\n    }\n    if (typeof options.showRecordId === 'boolean') {\n        findCommand.$showDiskLoc = options.showRecordId;\n    }\n    if (options.comment) {\n        findCommand.$comment = options.comment;\n    }\n    if (typeof options.maxTimeMS === 'number') {\n        findCommand.$maxTimeMS = options.maxTimeMS;\n    }\n    if (options.explain != null) {\n        findCommand.$explain = true;\n    }\n    return findCommand;\n}\noperation_1.defineAspects(FindOperation, [\n    operation_1.Aspect.READ_OPERATION,\n    operation_1.Aspect.RETRYABLE,\n    operation_1.Aspect.EXPLAINABLE,\n    operation_1.Aspect.CURSOR_CREATING\n]);\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}