{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ValidateCollectionOperation = void 0;\n\nconst command_1 = require(\"./command\");\n\nconst error_1 = require(\"../error\");\n/** @internal */\n\n\nclass ValidateCollectionOperation extends command_1.CommandOperation {\n  constructor(admin, collectionName, options) {\n    // Decorate command with extra options\n    const command = {\n      validate: collectionName\n    };\n    const keys = Object.keys(options);\n\n    for (let i = 0; i < keys.length; i++) {\n      if (Object.prototype.hasOwnProperty.call(options, keys[i]) && keys[i] !== 'session') {\n        command[keys[i]] = options[keys[i]];\n      }\n    }\n\n    super(admin.s.db, options);\n    this.options = options;\n    this.command = command;\n    this.collectionName = collectionName;\n  }\n\n  execute(server, session, callback) {\n    const collectionName = this.collectionName;\n    super.executeCommand(server, session, this.command, (err, doc) => {\n      if (err != null) return callback(err); // TODO(NODE-3483): Replace these with MongoUnexpectedServerResponseError\n\n      if (doc.ok === 0) return callback(new error_1.MongoRuntimeError('Error with validate command'));\n      if (doc.result != null && typeof doc.result !== 'string') return callback(new error_1.MongoRuntimeError('Error with validation data'));\n      if (doc.result != null && doc.result.match(/exception|corrupt/) != null) return callback(new error_1.MongoRuntimeError(`Invalid collection ${collectionName}`));\n      if (doc.valid != null && !doc.valid) return callback(new error_1.MongoRuntimeError(`Invalid collection ${collectionName}`));\n      return callback(undefined, doc);\n    });\n  }\n\n}\n\nexports.ValidateCollectionOperation = ValidateCollectionOperation;","map":{"version":3,"names":["Object","defineProperty","exports","value","ValidateCollectionOperation","command_1","require","error_1","CommandOperation","constructor","admin","collectionName","options","command","validate","keys","i","length","prototype","hasOwnProperty","call","s","db","execute","server","session","callback","executeCommand","err","doc","ok","MongoRuntimeError","result","match","valid","undefined"],"sources":["/Users/yoannesfigueiras/node_modules/mongodb/lib/operations/validate_collection.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ValidateCollectionOperation = void 0;\nconst command_1 = require(\"./command\");\nconst error_1 = require(\"../error\");\n/** @internal */\nclass ValidateCollectionOperation extends command_1.CommandOperation {\n    constructor(admin, collectionName, options) {\n        // Decorate command with extra options\n        const command = { validate: collectionName };\n        const keys = Object.keys(options);\n        for (let i = 0; i < keys.length; i++) {\n            if (Object.prototype.hasOwnProperty.call(options, keys[i]) && keys[i] !== 'session') {\n                command[keys[i]] = options[keys[i]];\n            }\n        }\n        super(admin.s.db, options);\n        this.options = options;\n        this.command = command;\n        this.collectionName = collectionName;\n    }\n    execute(server, session, callback) {\n        const collectionName = this.collectionName;\n        super.executeCommand(server, session, this.command, (err, doc) => {\n            if (err != null)\n                return callback(err);\n            // TODO(NODE-3483): Replace these with MongoUnexpectedServerResponseError\n            if (doc.ok === 0)\n                return callback(new error_1.MongoRuntimeError('Error with validate command'));\n            if (doc.result != null && typeof doc.result !== 'string')\n                return callback(new error_1.MongoRuntimeError('Error with validation data'));\n            if (doc.result != null && doc.result.match(/exception|corrupt/) != null)\n                return callback(new error_1.MongoRuntimeError(`Invalid collection ${collectionName}`));\n            if (doc.valid != null && !doc.valid)\n                return callback(new error_1.MongoRuntimeError(`Invalid collection ${collectionName}`));\n            return callback(undefined, doc);\n        });\n    }\n}\nexports.ValidateCollectionOperation = ValidateCollectionOperation;\n"],"mappings":"AAAA;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;EAAEC,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,2BAAR,GAAsC,KAAK,CAA3C;;AACA,MAAMC,SAAS,GAAGC,OAAO,CAAC,WAAD,CAAzB;;AACA,MAAMC,OAAO,GAAGD,OAAO,CAAC,UAAD,CAAvB;AACA;;;AACA,MAAMF,2BAAN,SAA0CC,SAAS,CAACG,gBAApD,CAAqE;EACjEC,WAAW,CAACC,KAAD,EAAQC,cAAR,EAAwBC,OAAxB,EAAiC;IACxC;IACA,MAAMC,OAAO,GAAG;MAAEC,QAAQ,EAAEH;IAAZ,CAAhB;IACA,MAAMI,IAAI,GAAGf,MAAM,CAACe,IAAP,CAAYH,OAAZ,CAAb;;IACA,KAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,IAAI,CAACE,MAAzB,EAAiCD,CAAC,EAAlC,EAAsC;MAClC,IAAIhB,MAAM,CAACkB,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCR,OAArC,EAA8CG,IAAI,CAACC,CAAD,CAAlD,KAA0DD,IAAI,CAACC,CAAD,CAAJ,KAAY,SAA1E,EAAqF;QACjFH,OAAO,CAACE,IAAI,CAACC,CAAD,CAAL,CAAP,GAAmBJ,OAAO,CAACG,IAAI,CAACC,CAAD,CAAL,CAA1B;MACH;IACJ;;IACD,MAAMN,KAAK,CAACW,CAAN,CAAQC,EAAd,EAAkBV,OAAlB;IACA,KAAKA,OAAL,GAAeA,OAAf;IACA,KAAKC,OAAL,GAAeA,OAAf;IACA,KAAKF,cAAL,GAAsBA,cAAtB;EACH;;EACDY,OAAO,CAACC,MAAD,EAASC,OAAT,EAAkBC,QAAlB,EAA4B;IAC/B,MAAMf,cAAc,GAAG,KAAKA,cAA5B;IACA,MAAMgB,cAAN,CAAqBH,MAArB,EAA6BC,OAA7B,EAAsC,KAAKZ,OAA3C,EAAoD,CAACe,GAAD,EAAMC,GAAN,KAAc;MAC9D,IAAID,GAAG,IAAI,IAAX,EACI,OAAOF,QAAQ,CAACE,GAAD,CAAf,CAF0D,CAG9D;;MACA,IAAIC,GAAG,CAACC,EAAJ,KAAW,CAAf,EACI,OAAOJ,QAAQ,CAAC,IAAInB,OAAO,CAACwB,iBAAZ,CAA8B,6BAA9B,CAAD,CAAf;MACJ,IAAIF,GAAG,CAACG,MAAJ,IAAc,IAAd,IAAsB,OAAOH,GAAG,CAACG,MAAX,KAAsB,QAAhD,EACI,OAAON,QAAQ,CAAC,IAAInB,OAAO,CAACwB,iBAAZ,CAA8B,4BAA9B,CAAD,CAAf;MACJ,IAAIF,GAAG,CAACG,MAAJ,IAAc,IAAd,IAAsBH,GAAG,CAACG,MAAJ,CAAWC,KAAX,CAAiB,mBAAjB,KAAyC,IAAnE,EACI,OAAOP,QAAQ,CAAC,IAAInB,OAAO,CAACwB,iBAAZ,CAA+B,sBAAqBpB,cAAe,EAAnE,CAAD,CAAf;MACJ,IAAIkB,GAAG,CAACK,KAAJ,IAAa,IAAb,IAAqB,CAACL,GAAG,CAACK,KAA9B,EACI,OAAOR,QAAQ,CAAC,IAAInB,OAAO,CAACwB,iBAAZ,CAA+B,sBAAqBpB,cAAe,EAAnE,CAAD,CAAf;MACJ,OAAOe,QAAQ,CAACS,SAAD,EAAYN,GAAZ,CAAf;IACH,CAbD;EAcH;;AA/BgE;;AAiCrE3B,OAAO,CAACE,2BAAR,GAAsCA,2BAAtC"},"metadata":{},"sourceType":"script"}