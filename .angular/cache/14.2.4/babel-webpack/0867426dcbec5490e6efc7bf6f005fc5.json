{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CountDocumentsOperation = void 0;\n\nconst aggregate_1 = require(\"./aggregate\");\n/** @internal */\n\n\nclass CountDocumentsOperation extends aggregate_1.AggregateOperation {\n  constructor(collection, query, options) {\n    const pipeline = [];\n    pipeline.push({\n      $match: query\n    });\n\n    if (typeof options.skip === 'number') {\n      pipeline.push({\n        $skip: options.skip\n      });\n    }\n\n    if (typeof options.limit === 'number') {\n      pipeline.push({\n        $limit: options.limit\n      });\n    }\n\n    pipeline.push({\n      $group: {\n        _id: 1,\n        n: {\n          $sum: 1\n        }\n      }\n    });\n    super(collection.s.namespace, pipeline, options);\n  }\n\n  execute(server, session, callback) {\n    super.execute(server, session, (err, result) => {\n      if (err || !result) {\n        callback(err);\n        return;\n      } // NOTE: We're avoiding creating a cursor here to reduce the callstack.\n\n\n      const response = result;\n\n      if (response.cursor == null || response.cursor.firstBatch == null) {\n        callback(undefined, 0);\n        return;\n      }\n\n      const docs = response.cursor.firstBatch;\n      callback(undefined, docs.length ? docs[0].n : 0);\n    });\n  }\n\n}\n\nexports.CountDocumentsOperation = CountDocumentsOperation;","map":{"version":3,"names":["Object","defineProperty","exports","value","CountDocumentsOperation","aggregate_1","require","AggregateOperation","constructor","collection","query","options","pipeline","push","$match","skip","$skip","limit","$limit","$group","_id","n","$sum","s","namespace","execute","server","session","callback","err","result","response","cursor","firstBatch","undefined","docs","length"],"sources":["/Users/yoannesfigueiras/node_modules/mongodb/lib/operations/count_documents.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.CountDocumentsOperation = void 0;\nconst aggregate_1 = require(\"./aggregate\");\n/** @internal */\nclass CountDocumentsOperation extends aggregate_1.AggregateOperation {\n    constructor(collection, query, options) {\n        const pipeline = [];\n        pipeline.push({ $match: query });\n        if (typeof options.skip === 'number') {\n            pipeline.push({ $skip: options.skip });\n        }\n        if (typeof options.limit === 'number') {\n            pipeline.push({ $limit: options.limit });\n        }\n        pipeline.push({ $group: { _id: 1, n: { $sum: 1 } } });\n        super(collection.s.namespace, pipeline, options);\n    }\n    execute(server, session, callback) {\n        super.execute(server, session, (err, result) => {\n            if (err || !result) {\n                callback(err);\n                return;\n            }\n            // NOTE: We're avoiding creating a cursor here to reduce the callstack.\n            const response = result;\n            if (response.cursor == null || response.cursor.firstBatch == null) {\n                callback(undefined, 0);\n                return;\n            }\n            const docs = response.cursor.firstBatch;\n            callback(undefined, docs.length ? docs[0].n : 0);\n        });\n    }\n}\nexports.CountDocumentsOperation = CountDocumentsOperation;\n"],"mappings":"AAAA;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;EAAEC,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,uBAAR,GAAkC,KAAK,CAAvC;;AACA,MAAMC,WAAW,GAAGC,OAAO,CAAC,aAAD,CAA3B;AACA;;;AACA,MAAMF,uBAAN,SAAsCC,WAAW,CAACE,kBAAlD,CAAqE;EACjEC,WAAW,CAACC,UAAD,EAAaC,KAAb,EAAoBC,OAApB,EAA6B;IACpC,MAAMC,QAAQ,GAAG,EAAjB;IACAA,QAAQ,CAACC,IAAT,CAAc;MAAEC,MAAM,EAAEJ;IAAV,CAAd;;IACA,IAAI,OAAOC,OAAO,CAACI,IAAf,KAAwB,QAA5B,EAAsC;MAClCH,QAAQ,CAACC,IAAT,CAAc;QAAEG,KAAK,EAAEL,OAAO,CAACI;MAAjB,CAAd;IACH;;IACD,IAAI,OAAOJ,OAAO,CAACM,KAAf,KAAyB,QAA7B,EAAuC;MACnCL,QAAQ,CAACC,IAAT,CAAc;QAAEK,MAAM,EAAEP,OAAO,CAACM;MAAlB,CAAd;IACH;;IACDL,QAAQ,CAACC,IAAT,CAAc;MAAEM,MAAM,EAAE;QAAEC,GAAG,EAAE,CAAP;QAAUC,CAAC,EAAE;UAAEC,IAAI,EAAE;QAAR;MAAb;IAAV,CAAd;IACA,MAAMb,UAAU,CAACc,CAAX,CAAaC,SAAnB,EAA8BZ,QAA9B,EAAwCD,OAAxC;EACH;;EACDc,OAAO,CAACC,MAAD,EAASC,OAAT,EAAkBC,QAAlB,EAA4B;IAC/B,MAAMH,OAAN,CAAcC,MAAd,EAAsBC,OAAtB,EAA+B,CAACE,GAAD,EAAMC,MAAN,KAAiB;MAC5C,IAAID,GAAG,IAAI,CAACC,MAAZ,EAAoB;QAChBF,QAAQ,CAACC,GAAD,CAAR;QACA;MACH,CAJ2C,CAK5C;;;MACA,MAAME,QAAQ,GAAGD,MAAjB;;MACA,IAAIC,QAAQ,CAACC,MAAT,IAAmB,IAAnB,IAA2BD,QAAQ,CAACC,MAAT,CAAgBC,UAAhB,IAA8B,IAA7D,EAAmE;QAC/DL,QAAQ,CAACM,SAAD,EAAY,CAAZ,CAAR;QACA;MACH;;MACD,MAAMC,IAAI,GAAGJ,QAAQ,CAACC,MAAT,CAAgBC,UAA7B;MACAL,QAAQ,CAACM,SAAD,EAAYC,IAAI,CAACC,MAAL,GAAcD,IAAI,CAAC,CAAD,CAAJ,CAAQd,CAAtB,GAA0B,CAAtC,CAAR;IACH,CAbD;EAcH;;AA5BgE;;AA8BrEnB,OAAO,CAACE,uBAAR,GAAkCA,uBAAlC"},"metadata":{},"sourceType":"script"}